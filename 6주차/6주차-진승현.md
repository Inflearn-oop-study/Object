## 상속과 코드 재사용

상속이란, 클래스 안에 정의된 인스턴스 변수와 메서드를 자동으로 새로운 클래스에 추가하는 구현 기법이다.

객체지향에서는 상속 외에도 코드를 재사용하는 기법이 하나 더 있는데, 새로운 클래스의 인스턴스 안에 기존 클래스의 인스턴스를 포함시키는 방법인 합성이 존재한다.

코드를 재사용하는 이유는, 결국 중복을 제거하기 위함이다. 중복된 코드는 왜 문제가 되는걸까?

### 1. 상속과 중복 코드

중복 코드를 보는 순간, 과연 이 코드가 정말 동일한 코드인지, 동일하다면 왜 새롭게 코드를 작성한건지, 없애도 문제가 없는지 등등 사람을 고민에 빠지게 만든다. 

이처럼 중복 코드는 코드의 변경을 방해한다는 문제가 있다.

DRY 원칙 : Don’t Repeat Yourself, 동일한 지식을 중복하지 말아라. 즉 코드가 중복돼선 안된다.

중복 코드를 제거하고자 상속을 고민해볼 수 있다. 하지만 상속은 부모 클래스와 자식 클래스간 강한 결합이 문제가 될 수 있으며, super() 메소드와 같은 새로운 중복 코드가 생성될 수 있다.

즉 부모 클래스의 변경에 자식 클래스가 영향을 크게 받는다는 사실을 알 수 있다는 문제를 어떻게 해결할지 고민해볼 필요가 있다.

### 취약한 기반 클래스 문제

부모 클래스와 자식 클래스간 강한 결합도로 인해 부모 클래스의 변경에 자식 클래스도 영향을 받게 된다. 이와 같은 현상을 취약한 기반 클래스 문제 ( Fragile Base Class Problem, Brittle Base Class Problem ) 라고 부른다.

### Phone 다시 살펴보기

상속의 문제를 해결하기 위해, 자식 클래스가 부모 클래스의 구현체가 아닌 추상화에 의존할 필요가 있다.

- 차이가 있는 코드 찾기
- 중복 코드 추상 클래스로 옮기기

즉 공통적인 핵심 로직은 최대한 추상화하는 것이 좋다.

### 차이에 의한 프로그래밍

상속의 장점은 이미 존재하는 클래스의 코드를 기반으로 다른 부분을 추가로 구현함으로써 새로운 기능을 빠르게 추가할 수 있다는 점이다.

이처럼 기존 코드와 다른 부분만을 추가함으로써 애플리케이션의 기능을 확장하는 방법을 차이에 의한 프로그래밍 ( programming by difference ) 이라고 부른다.

차이에 의한 프로그래밍의 목표는 중복 코드를 제거하고 코드를 재사용하는 것이다. 중복 코드를 제거한다는 말과 코드를 재사용한다는 말은 사실상 같은 말이라고 볼 수 있는데, 결국 공통 로직을 추상화하는 과정이라고 볼 수 있다.

## 합성과 유연한 설계

합성은 전체를 표현하는 객체가 부분을 표현하는 객체를 포함해서 부분 객체의 코드를 재사용한다.

상속에서 부모 클래스와 자식 클래스 사이의 의존성을 컴파일타임에 해결되지만, 합성에서 두 객체 사이의 의존성은 런타임에 해결된다. 즉 합성 관계는 실행시점에 동적으로 변경할 수 있기 때문에 유연한 설계를 가져갈 수 있다.

### 상속을 합성으로 변경하기

합성으로 변경함으로써 다음과 같은 문제점들을 해결할 수 있었다.

- 불필요한 인터페이스 상속 문제
    - 기존 상속관계에서 합성관계로 변경하니 필요하지 않은 메소드들이 포함되지 않음
    - 덕분에 사용자가 실수할 가능성을 줄일 수 있음
- 메서드 오버라이딩의 오작용 문제
    - 오버라이딩한 인스턴스 메서드에서 개발자가 의도한 메서드 호출을 그대로 전달할 수 있음
    - 이를 포워딩이라고 부르며, 동일한 메서드를 호출하기 위해 추가된 메서드를 포워딩 메서드라고 부름

### 상속으로 인한 조합의 폭발적인 증가

부가 정책을 추가하는 과정에서 상속을 활용할 경우, 모든 조합별로 자식 클래스를 하나씩 추가해줌으로써 부가 정책을 추가할 수 있었다.

이처럼 하나의 기능을 추가하기 위해 필요 이상으로 많은 수의 클래스를 추가해야 하는 경우를 가리켜 클래스 폭발 ( class explosion ) 문제 또는 조합의 폭발 ( combinational explosion ) 문제라고 부른다.

클래스 폭발 문제는 자식 클래스가 부모 클래스의 구현에 강하게 결합되도록 강요하는 상속의 근본적인 한계 때문에 발생하는 문제다. 컴파일타임에 자식과 부모간 관계가 결정되기 때문에, 조합의 수만큼 클래스를 새로 추가해주었기 때문이다.

그렇기때문에 이 문제를 해결하려면, 상속을 포기해야 한다.

### 합성 관계로 변경하기

여러 기능을 조합해야하는 설계에서 합성은 기존 컴파일타임 관계에서 발생했던 문제를 런타임 관계로 변경함으로써 이 문제를 해결한다.

합성을 사용하면 실행 시점에 정책들의 관계를 유연하게 변경할 수 있기 때문이다. ( 구현이 아닌 추상적인 인터페이스에 의존하기 때문 )

### 믹스인

믹스인 ( mixin ) 은 객체를 생성할 때 코드 일부를 클래스 안에 섞어 넣어 재사용하는 기법을 가리키는 용어다.

즉 컴파일 시점에 필요한 코드 조각을 조합하는 재사용 방법이다.